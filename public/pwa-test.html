<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Installability Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-item { background: white; margin: 10px 0; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .info { color: blue; }
        .warning { color: orange; }
        button { background: #bb5175; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #a0445f; }
        .install-button { background: #28a745; }
        .install-button:hover { background: #218838; }
    </style>
</head>
<body>
    <h1>üîß PWA Installability Test</h1>
    
    <div class="test-item">
        <h3>PWA Krit√©riumok Ellen≈ërz√©se</h3>
        <div id="criteria-results"></div>
    </div>
    
    <div class="test-item">
        <h3>Manifest Ellen≈ërz√©se</h3>
        <div id="manifest-results"></div>
    </div>
    
    <div class="test-item">
        <h3>Service Worker Ellen≈ërz√©se</h3>
        <div id="sw-results"></div>
    </div>
    
    <div class="test-item">
        <h3>B√∂ng√©sz≈ë T√°mogat√°s</h3>
        <div id="browser-results"></div>
    </div>
    
    <div class="test-item">
        <h3>Telep√≠t√©si Gomb Teszt</h3>
        <button id="test-install" class="install-button">Telep√≠t√©si Gomb Teszt</button>
        <button id="clear-dismissed">Elutas√≠t√°s T√∂rl√©se</button>
        <div id="install-results"></div>
    </div>
    
    <div class="test-item">
        <h3>Debug Inform√°ci√≥</h3>
        <div id="debug-info"></div>
    </div>

    <script>
        let deferredPrompt = null;
        
        // PWA krit√©riumok ellen≈ërz√©se
        function checkPWACriteria() {
            const results = document.getElementById('criteria-results');
            const criteria = {
                'HTTPS vagy localhost': location.protocol === 'https:' || location.hostname === 'localhost',
                'Service Worker t√°mogat√°s': 'serviceWorker' in navigator,
                'Manifest link': document.querySelector('link[rel="manifest"]') !== null,
                'Standalone display': !window.matchMedia('(display-mode: standalone)').matches,
                'iOS standalone': !(navigator.standalone === true)
            };
            
            let html = '';
            for (const [key, value] of Object.entries(criteria)) {
                html += `<div class="${value ? 'pass' : 'fail'}">${value ? '‚úÖ' : '‚ùå'} ${key}</div>`;
            }
            results.innerHTML = html;
        }
        
        // Manifest ellen≈ërz√©se
        async function checkManifest() {
            const results = document.getElementById('manifest-results');
            try {
                const manifestLink = document.querySelector('link[rel="manifest"]');
                if (!manifestLink) {
                    results.innerHTML = '<div class="fail">‚ùå Nincs manifest link</div>';
                    return;
                }
                
                const response = await fetch(manifestLink.href);
                const manifest = await response.json();
                
                const requiredFields = {
                    'name': manifest.name,
                    'short_name': manifest.short_name,
                    'start_url': manifest.start_url,
                    'display': manifest.display,
                    'icons': manifest.icons && manifest.icons.length > 0,
                    'theme_color': manifest.theme_color,
                    'background_color': manifest.background_color
                };
                
                let html = '';
                for (const [key, value] of Object.entries(requiredFields)) {
                    html += `<div class="${value ? 'pass' : 'fail'}">${value ? '‚úÖ' : '‚ùå'} ${key}: ${value || 'Nincs'}</div>`;
                }
                
                // Ikonok ellen≈ërz√©se
                if (manifest.icons) {
                    html += '<div class="info">üì± Ikonok:</div>';
                    manifest.icons.forEach(icon => {
                        html += `<div class="info">  - ${icon.sizes} (${icon.purpose || 'any'})</div>`;
                    });
                }
                
                results.innerHTML = html;
            } catch (error) {
                results.innerHTML = `<div class="fail">‚ùå Manifest bet√∂lt√©si hiba: ${error.message}</div>`;
            }
        }
        
        // Service Worker ellen≈ërz√©se
        async function checkServiceWorker() {
            const results = document.getElementById('sw-results');
            try {
                if (!('serviceWorker' in navigator)) {
                    results.innerHTML = '<div class="fail">‚ùå Service Worker nem t√°mogatott</div>';
                    return;
                }
                
                const registration = await navigator.serviceWorker.getRegistration();
                if (registration) {
                    results.innerHTML = `
                        <div class="pass">‚úÖ Service Worker regisztr√°lva</div>
                        <div class="info">Scope: ${registration.scope}</div>
                        <div class="info">√Ållapot: ${registration.active ? 'Akt√≠v' : 'Inakt√≠v'}</div>
                    `;
                } else {
                    results.innerHTML = '<div class="fail">‚ùå Service Worker nincs regisztr√°lva</div>';
                }
            } catch (error) {
                results.innerHTML = `<div class="fail">‚ùå Service Worker hiba: ${error.message}</div>`;
            }
        }
        
        // B√∂ng√©sz≈ë t√°mogat√°s ellen≈ërz√©se
        function checkBrowserSupport() {
            const results = document.getElementById('browser-results');
            const userAgent = navigator.userAgent;
            const isChrome = /Chrome/.test(userAgent) && /Google Inc/.test(navigator.vendor);
            const isEdge = /Edg/.test(userAgent);
            const isFirefox = /Firefox/.test(userAgent);
            const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
            
            let html = `
                <div class="info">üåê B√∂ng√©sz≈ë: ${userAgent}</div>
                <div class="${isChrome ? 'pass' : 'info'}">${isChrome ? '‚úÖ' : '‚ÑπÔ∏è'} Chrome: ${isChrome}</div>
                <div class="${isEdge ? 'pass' : 'info'}">${isEdge ? '‚úÖ' : '‚ÑπÔ∏è'} Edge: ${isEdge}</div>
                <div class="${isFirefox ? 'pass' : 'info'}">${isFirefox ? '‚úÖ' : '‚ÑπÔ∏è'} Firefox: ${isFirefox}</div>
                <div class="${isSafari ? 'pass' : 'info'}">${isSafari ? '‚úÖ' : '‚ÑπÔ∏è'} Safari: ${isSafari}</div>
            `;
            
            results.innerHTML = html;
        }
        
        // Telep√≠t√©si gomb teszt
        function testInstallButton() {
            const results = document.getElementById('install-results');
            let html = '';
            
            if (deferredPrompt) {
                html += '<div class="pass">‚úÖ Deferred prompt el√©rhet≈ë</div>';
            } else {
                html += '<div class="warning">‚ö†Ô∏è Nincs deferred prompt</div>';
            }
            
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            const isIOSStandalone = navigator.standalone === true;
            
            html += `<div class="${isStandalone ? 'pass' : 'info'}">${isStandalone ? '‚úÖ' : '‚ÑπÔ∏è'} Standalone m√≥d: ${isStandalone}</div>`;
            html += `<div class="${isIOSStandalone ? 'pass' : 'info'}">${isIOSStandalone ? '‚úÖ' : '‚ÑπÔ∏è'} iOS Standalone: ${isIOSStandalone}</div>`;
            
            const dismissed = localStorage.getItem('pwa-install-dismissed');
            html += `<div class="info">Elutas√≠tva: ${dismissed === 'true' ? 'Igen' : 'Nem'}</div>`;
            
            results.innerHTML = html;
        }
        
        // Debug inform√°ci√≥k
        function showDebugInfo() {
            const results = document.getElementById('debug-info');
            const debugInfo = {
                'URL': location.href,
                'Protokoll': location.protocol,
                'Hostname': location.hostname,
                'User Agent': navigator.userAgent,
                'Online': navigator.onLine,
                'Standalone': window.matchMedia('(display-mode: standalone)').matches,
                'iOS Standalone': navigator.standalone === true,
                'Deferred Prompt': !!deferredPrompt,
                'Manifest Link': !!document.querySelector('link[rel="manifest"]'),
                'Service Worker': 'serviceWorker' in navigator
            };
            
            let html = '';
            for (const [key, value] of Object.entries(debugInfo)) {
                html += `<div class="info">${key}: ${value}</div>`;
            }
            
            results.innerHTML = html;
        }
        
        // Event listener-ek
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt event fired');
            deferredPrompt = e;
            testInstallButton();
        });
        
        window.addEventListener('appinstalled', () => {
            console.log('appinstalled event fired');
            testInstallButton();
        });
        
        // Gombok
        document.getElementById('test-install').addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    console.log('User choice:', choiceResult.outcome);
                    testInstallButton();
                });
            } else {
                alert('Nincs telep√≠t√©si prompt el√©rhet≈ë. Ellen≈ërizd a b√∂ng√©sz≈ë c√≠msor√°t!');
            }
        });
        
        document.getElementById('clear-dismissed').addEventListener('click', () => {
            localStorage.removeItem('pwa-install-dismissed');
            alert('Elutas√≠t√°s t√∂r√∂lve!');
            testInstallButton();
        });
        
        // Inicializ√°l√°s
        checkPWACriteria();
        checkManifest();
        checkServiceWorker();
        checkBrowserSupport();
        testInstallButton();
        showDebugInfo();
        
        // Automatikus friss√≠t√©s 5 m√°sodpercenk√©nt
        setInterval(() => {
            testInstallButton();
        }, 5000);
    </script>
</body>
</html>

